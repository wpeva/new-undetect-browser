@echo off
:: UndetectBrowser - ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð´Ð»Ñ Windows
:: Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ Node.js v18, v20, v22, v24 Ð¸ Ð²Ñ‹ÑˆÐµ
chcp 65001 >nul
title UndetectBrowser - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
color 0B
cls

cd /d "%~dp0"

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo         UndetectBrowser - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: ============================================================================
:: Ð¨ÐÐ“ 1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Node.js
:: ============================================================================
echo [1/5] ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Node.js...

where node >nul 2>&1
if errorlevel 1 (
    echo.
    echo  âŒ Node.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!
    echo  ðŸ“¥ ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ: https://nodejs.org/
    echo.
    start https://nodejs.org/
    echo  ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð»
    echo.
    pause
    exit /b 1
)

:: ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð²ÐµÑ€ÑÐ¸ÑŽ Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ (Ð»ÑŽÐ±Ð°Ñ 18+ Ð¿Ð¾Ð´Ð¾Ð¹Ð´ÐµÑ‚)
for /f "tokens=*" %%i in ('node --version') do set NODE_VERSION=%%i
echo   âœ… Node.js %NODE_VERSION% Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½
echo.

:: ============================================================================
:: Ð¨ÐÐ“ 2: ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° (Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ v24!)
:: ============================================================================
echo [2/5] ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²...

if exist "node_modules" (
    echo   ðŸ—‘ï¸  Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ node_modules...
    rmdir /s /q node_modules 2>nul
)

if exist "frontend\node_modules" (
    echo   ðŸ—‘ï¸  Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ frontend\node_modules...
    rmdir /s /q frontend\node_modules 2>nul
)

if exist "package-lock.json" (
    echo   ðŸ—‘ï¸  Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ package-lock.json...
    del /f /q package-lock.json 2>nul
)

if exist "frontend\package-lock.json" (
    echo   ðŸ—‘ï¸  Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ frontend\package-lock.json...
    del /f /q frontend\package-lock.json 2>nul
)

if exist "dist" (
    echo   ðŸ—‘ï¸  Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ dist...
    rmdir /s /q dist 2>nul
)

echo   âœ… ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°
echo.

:: ============================================================================
:: Ð¨ÐÐ“ 3: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° backend Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
:: ============================================================================
echo [3/5] Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ (ÑÑ‚Ð¾ Ð·Ð°Ð¹Ð¼ÐµÑ‚ 2-3 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹)...
echo   â³ ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð° Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ...
echo.

:: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ --force Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¾ Ð²ÐµÑ€ÑÐ¸Ð¸
call npm install --legacy-peer-deps --force --loglevel=error

if errorlevel 1 (
    echo.
    echo  âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹!
    echo  ðŸ’¡ ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ:
    echo     1. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¾Ñ‚ Ð¸Ð¼ÐµÐ½Ð¸ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°
    echo     2. Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð°Ð¿ÐºÑƒ node_modules Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
    echo     3. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
    echo.
    pause
    exit /b 1
)

echo.
echo   âœ… Backend Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹
echo.

:: ============================================================================
:: Ð¨ÐÐ“ 3.5: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° frontend Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
:: ============================================================================
if exist "frontend" (
    echo   ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° frontend Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹...
    cd frontend
    call npm install --force --loglevel=error
    cd ..
    echo   âœ… Frontend Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹
    echo.
)

:: ============================================================================
:: Ð¨ÐÐ“ 4: ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ TypeScript
:: ============================================================================
echo [4/5] ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°...

call npm run build:safe >nul 2>&1
if errorlevel 1 (
    echo   âš ï¸  Ð•ÑÑ‚ÑŒ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ, Ð½Ð¾ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼...
) else (
    echo   âœ… ÐŸÑ€Ð¾ÐµÐºÑ‚ ÑÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
)
echo.

:: ============================================================================
:: Ð¨ÐÐ“ 5: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
:: ============================================================================
echo [5/5] Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸...

if not exist ".env" (
    (
        echo # UndetectBrowser Configuration
        echo # Auto-generated
        echo.
        echo PORT=3000
        echo FRONTEND_PORT=3001
        echo NODE_ENV=production
        echo HOST=0.0.0.0
        echo.
        echo # Security
        echo JWT_SECRET=secret-%RANDOM%-%RANDOM%
        echo ENABLE_AUTH=false
        echo.
        echo # Browser Settings
        echo HEADLESS=false
        echo ENABLE_STEALTH=true
        echo.
        echo # Logging
        echo LOG_LEVEL=info
    ) > .env
    echo   âœ… Ð¤Ð°Ð¹Ð» .env ÑÐ¾Ð·Ð´Ð°Ð½
) else (
    echo   â„¹ï¸  Ð¤Ð°Ð¹Ð» .env ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
)

:: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð¿Ð°Ð¿Ð¾Ðº
mkdir data 2>nul
mkdir data\profiles 2>nul
mkdir data\sessions 2>nul
mkdir data\logs 2>nul
mkdir logs 2>nul
mkdir build 2>nul

echo   âœ… ÐŸÐ°Ð¿ÐºÐ¸ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹
echo.

:: ============================================================================
:: Ð“ÐžÐ¢ÐžÐ’Ðž!
:: ============================================================================
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo               âœ… Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ!
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo  ðŸš€ Ð”Ð›Ð¯ Ð—ÐÐŸÐ£Ð¡ÐšÐ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ:
echo.
echo    Ð”Ð²Ð¾Ð¹Ð½Ð¾Ð¹ ÐºÐ»Ð¸Ðº Ð½Ð°: START_ONE_CLICK.vbs
echo.
echo    Ð˜Ð»Ð¸ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ:   START_SIMPLE.bat
echo.
echo  ðŸ“± Ð ÐµÐ¶Ð¸Ð¼Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:
echo     1 - Desktop Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ (Electron)
echo     2 - Ð’ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ (http://localhost:3001)
echo     3 - Ð¢ÐµÑÑ‚ Ð°Ð½Ñ‚Ð¸Ð´ÐµÑ‚ÐµÐºÑ‚Ð°
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo  ðŸ’¡ ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð»ÑŽÐ±ÑƒÑŽ ÐºÐ»Ð°Ð²Ð¸ÑˆÑƒ Ð´Ð»Ñ Ð²Ñ‹Ñ…Ð¾Ð´Ð°...
pause >nul
